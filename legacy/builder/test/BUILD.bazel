load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "test",
    srcs = [
        "helper.go",
        "helper_tools_downloader.go",
    ],
    importpath = "github.com/arduino/arduino-cli/legacy/builder/test",
    visibility = ["//visibility:public"],
    deps = [
        "//arduino/libraries",
        "//legacy/builder/constants",
        "//legacy/builder/gohasissues",
        "//legacy/builder/types",
        "//legacy/builder/utils",
        "@com_github_arduino_go_paths_helper//:go-paths-helper",
        "@com_github_arduino_go_properties_orderedmap//:go-properties-orderedmap",
        "@com_github_pkg_errors//:errors",
        "@com_github_stretchr_testify//assert",
    ],
)

go_test(
    name = "test_test",
    srcs = [
        "add_additional_entries_to_context_test.go",
        "add_build_board_property_if_missing_test.go",
        "builder_test.go",
        "builder_utils_test.go",
        "create_build_options_map_test.go",
        "ctags_runner_test.go",
        "fail_if_buildpath_equals_sketchpath_test.go",
        "hardware_loader_test.go",
        "i18n_test.go",
        "includes_finder_with_regexp_test.go",
        "includes_to_include_folders_test.go",
        "libraries_loader_test.go",
        "load_previous_build_options_map_test.go",
        "load_vid_pid_specific_properties_test.go",
        "merge_sketch_with_bootloader_test.go",
        "platform_keys_rewrite_loader_test.go",
        "prototypes_adder_test.go",
        "read_file_and_store_in_context_test.go",
        "recipe_runner_test.go",
        "rewrite_hardware_keys_test.go",
        "setup_build_properties_test.go",
        "store_build_options_map_test.go",
        "target_board_resolver_test.go",
        "tools_loader_test.go",
        "try_build_of_problematic_sketch_test.go",
        "unique_string_queue_test.go",
        "unused_compiled_libraries_remover_test.go",
        "utils_test.go",
        "wipeout_build_path_if_build_options_changed_test.go",
    ],
    embed = [":test"],
    deps = [
        "//arduino/cores",
        "//arduino/libraries",
        "//legacy/builder",
        "//legacy/builder/builder_utils",
        "//legacy/builder/constants",
        "//legacy/builder/gohasissues",
        "//legacy/builder/i18n",
        "//legacy/builder/phases",
        "//legacy/builder/types",
        "//legacy/builder/utils",
        "@com_github_arduino_go_paths_helper//:go-paths-helper",
        "@com_github_arduino_go_properties_orderedmap//:go-properties-orderedmap",
        "@com_github_stretchr_testify//require",
    ],
)
